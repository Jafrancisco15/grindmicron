<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Grind â†’ Micrones (v2.1.1)</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
<header>
  <h1>Conversor de Molienda a Micrones â€¢ v2.1.1</h1>
  <p class="subtitle">Zoom/Pan + ROIs. TipografÃ­a Poppins y franja amarilla en todas las secciones.</p>
</header>

<main>
  <section class="card">
    <h2>1) CalibraciÃ³n con regla</h2>
    <div class="row">
      <div class="uploader">
        <label class="btn">
          ğŸ“ Subir foto de la regla
          <input type="file" id="rulerInput" accept="image/*" hidden>
        </label>
        <div id="rulerProgress" class="progress hidden">
          <div class="bar" id="rulerBar"></div>
        </div>
        <div id="rulerInfo" class="info"></div>
      </div>
      <div class="tools">
        <button id="autoCalBtn" class="btn">Auto-calibrar (1 mm)</button>
        <button id="manualCalBtn" class="btn alt">Manual 0â€“1 cm</button>
        <button id="saveCalBtn" class="btn green">Guardar</button>
        <button id="clearCalBtn" class="btn danger">Borrar</button>
      </div>
    </div>
    <div class="row">
      <div class="canvasWrap">
        <canvas id="rulerCanvas"></canvas>
      </div>
      <div class="panel">
        <div class="kv"><div>px / mm</div><div id="pxPerMM">â€”</div></div>
        <div class="kv"><div>mm / px</div><div id="mmPerPx">â€”</div></div>
        <div class="kv"><div>Origen</div><div id="calSource">â€”</div></div>
        <div class="kv"><div>Guardado</div><div id="calSaved">â€”</div></div>
        <p class="hint">Selecciona un Ã¡rea de la regla (ROI), usa Auto o Manual (clic en 0 y 1 cm).</p>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>2) Analizar molienda</h2>
    <div class="row">
      <div class="uploader">
        <label class="btn">
          â˜• Subir foto de molienda
          <input type="file" id="grindInput" accept="image/*" hidden>
        </label>
        <div id="grindProgress" class="progress hidden">
          <div class="bar" id="grindBar"></div>
        </div>
        <div id="grindInfo" class="info"></div>
      </div>
      <div class="tools">
        <label class="inline">MÃ©todo:
          <select id="thrMethod">
            <option value="pct">Percentil</option>
            <option value="otsu">Otsu</option>
          </select>
        </label>
        <label class="inline">Umbral (%):
          <input type="range" id="thr" min="10" max="90" value="55">
          <span id="thrVal">55</span>
        </label>
        <label class="inline">SeparaciÃ³n (px):
          <input type="range" id="sepa" min="0" max="8" value="2">
          <span id="sepaVal">2</span>
        </label>
        <label class="inline">TamaÃ±o mÃ­nimo (pxÂ²):
          <input type="range" id="minArea" min="5" max="800" value="40">
          <span id="minAreaVal">40</span>
        </label>
        <label class="inline"><input type="checkbox" id="ignoreEdges" checked> Ignorar objetos en borde</label>
        <button id="analyzeBtn" class="btn">Calcular</button>
        <button id="exportCsvBtn" class="btn alt">Exportar CSV</button>
        <button id="savePngBtn" class="btn alt">Descargar PNG</button>
      </div>
    </div>

    <div class="row">
      <div class="canvasWrap" id="grindWrap">
        <div class="toolbar">
          <button id="enableNav" class="btn small">ğŸ–±ï¸ Zoom/Pan</button>
          <button id="addRoi" class="btn small">â• Nueva Ã¡rea</button>
          <button id="clearRois" class="btn small danger">ğŸ—‘ï¸ Limpiar Ã¡reas</button>
          <button id="resetView" class="btn small alt">âŸ³ Reset vista</button>
        </div>
        <canvas id="grindCanvas"></canvas>
      </div>
      <div class="panel">
        <div class="kv"><div>D10 (Î¼m)</div><div id="d10">â€”</div></div>
        <div class="kv"><div>D50 (Î¼m)</div><div id="d50">â€”</div></div>
        <div class="kv"><div>D90 (Î¼m)</div><div id="d90">â€”</div></div>
        <div class="kv"><div>Media (Î¼m)</div><div id="mean">â€”</div></div>
        <div class="kv"><div>Conteo</div><div id="count">â€”</div></div>
        <div class="kv"><div>Ãreas (ROI)</div><div id="roiInfo">â€”</div></div>
        <div class="histWrap">
          <canvas id="histCanvas" width="360" height="160"></canvas>
        </div>
        <p class="hint">Dibuja uno o varios ROIs. Usa rueda para zoom y arrastra para pan (modo Zoom/Pan activado).</p>
      </div>
    </div>
  </section>
</main>

<footer>
  <small>Hecho con â¤ï¸ para Escuela de CafÃ© â€” v2.1.1</small>
</footer>

<script src="./app.js"></script>
</body>
</html>
