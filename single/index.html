<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Grind ‚Üí Micrones (v2.1.1)</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>:root{
  --brand: #eab308;
  --bg: #0f1115;
  --card: #141821;
  --border: #222;
  --ink: #eee;
  --muted: #9fb3c8;
  --alt: #2f394a;
  --danger: #d9534f;
  --green: #19a974;
  --panel: #0c0f14;
  --hist: #2b90d9;
}
*{box-sizing:border-box}
body{font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink)}
header{padding:16px 20px;border-bottom:1px solid var(--border);background:#111}
h1{margin:0 0 4px;font-size:20px;font-weight:600}
h2{font-weight:600}
.subtitle{margin:0;color:#bbb}
main{max-width:1200px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;position:relative;overflow:hidden}
/* Franja amarilla en TODAS las secciones */
.card::before{content:'';position:absolute;left:0;top:0;width:100%;height:6px;background:var(--brand)}
.card h2{margin:8px 0 10px;padding:8px 10px;background:#1f2632;border-radius:10px;display:inline-block}
.row{display:flex;gap:16px;flex-wrap:wrap}
.canvasWrap{flex:2;min-width:360px;background:var(--panel);border:1px dashed #333;border-radius:12px;position:relative;padding:8px}
canvas{max-width:100%;display:block;border-radius:8px;background:#0a0d11}
.panel{flex:1;min-width:280px;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:6px}
.kv{display:grid;grid-template-columns:1fr auto;gap:8px;padding:6px 8px;border-bottom:1px solid #1a1f29}
.kv:last-child{border-bottom:0}
.hint{color:var(--muted);font-size:12px;margin-top:8px}
.btn{background:var(--brand);color:#1a1a1a;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;display:inline-flex;gap:8px;align-items:center;box-shadow:0 3px 0 rgba(0,0,0,.25);font-weight:600}
.btn.alt{background:var(--alt);color:var(--ink)}
.btn.green{background:var(--green);color:#fff}
.btn.danger{background:var(--danger);color:#fff}
.btn.small{font-size:12px;padding:6px 10px}
.btn:active{transform:translateY(1px)}
.tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.uploader{display:flex;flex-direction:column;gap:8px}
.info{font-size:12px;color:var(--muted)}
.inline{display:flex;gap:6px;align-items:center;background:#1b2230;padding:6px 8px;border-radius:8px}
.progress{width:280px;height:10px;background:#1f2632;border-radius:20px;overflow:hidden;border:1px solid #2a3342}
.progress .bar{height:100%;background:var(--brand);width:0%}
.hidden{display:none}
.histWrap{margin-top:8px;border:1px solid #1a1f29;border-radius:8px;overflow:hidden;background:#0a0d11}
footer{padding:16px;text-align:center;color:#99a3b5}
.selectRect{position:absolute;border:2px dashed var(--brand);pointer-events:none}
.toolbar{position:absolute;top:10px;left:10px;display:flex;gap:6px;z-index:2}
.roi{position:absolute;border:2px solid var(--brand);background:rgba(234,179,8,0.10);pointer-events:none}
</style>
</head>
<body>
<header>
  <h1>Conversor de Molienda a Micrones ‚Ä¢ v2.1.1</h1>
  <p class="subtitle">Zoom/Pan + ROIs. Tipograf√≠a Poppins y franja amarilla en todas las secciones.</p>
</header>

<main>
  <section class="card">
    <h2>1) Calibraci√≥n con regla</h2>
    <div class="row">
      <div class="uploader">
        <label class="btn">
          üìè Subir foto de la regla
          <input type="file" id="rulerInput" accept="image/*" hidden>
        </label>
        <div id="rulerProgress" class="progress hidden">
          <div class="bar" id="rulerBar"></div>
        </div>
        <div id="rulerInfo" class="info"></div>
      </div>
      <div class="tools">
        <button id="autoCalBtn" class="btn">Auto-calibrar (1 mm)</button>
        <button id="manualCalBtn" class="btn alt">Manual 0‚Äì1 cm</button>
        <button id="saveCalBtn" class="btn green">Guardar</button>
        <button id="clearCalBtn" class="btn danger">Borrar</button>
      </div>
    </div>
    <div class="row">
      <div class="canvasWrap">
        <canvas id="rulerCanvas"></canvas>
      </div>
      <div class="panel">
        <div class="kv"><div>px / mm</div><div id="pxPerMM">‚Äî</div></div>
        <div class="kv"><div>mm / px</div><div id="mmPerPx">‚Äî</div></div>
        <div class="kv"><div>Origen</div><div id="calSource">‚Äî</div></div>
        <div class="kv"><div>Guardado</div><div id="calSaved">‚Äî</div></div>
        <p class="hint">Selecciona un √°rea de la regla (ROI), usa Auto o Manual (clic en 0 y 1 cm).</p>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>2) Analizar molienda</h2>
    <div class="row">
      <div class="uploader">
        <label class="btn">
          ‚òï Subir foto de molienda
          <input type="file" id="grindInput" accept="image/*" hidden>
        </label>
        <div id="grindProgress" class="progress hidden">
          <div class="bar" id="grindBar"></div>
        </div>
        <div id="grindInfo" class="info"></div>
      </div>
      <div class="tools">
        <label class="inline">M√©todo:
          <select id="thrMethod">
            <option value="pct">Percentil</option>
            <option value="otsu">Otsu</option>
          </select>
        </label>
        <label class="inline">Umbral (%):
          <input type="range" id="thr" min="10" max="90" value="55">
          <span id="thrVal">55</span>
        </label>
        <label class="inline">Separaci√≥n (px):
          <input type="range" id="sepa" min="0" max="8" value="2">
          <span id="sepaVal">2</span>
        </label>
        <label class="inline">Tama√±o m√≠nimo (px¬≤):
          <input type="range" id="minArea" min="5" max="800" value="40">
          <span id="minAreaVal">40</span>
        </label>
        <label class="inline"><input type="checkbox" id="ignoreEdges" checked> Ignorar objetos en borde</label>
        <button id="analyzeBtn" class="btn">Calcular</button>
        <button id="exportCsvBtn" class="btn alt">Exportar CSV</button>
        <button id="savePngBtn" class="btn alt">Descargar PNG</button>
      </div>
    </div>

    <div class="row">
      <div class="canvasWrap" id="grindWrap">
        <div class="toolbar">
          <button id="enableNav" class="btn small">üñ±Ô∏è Zoom/Pan</button>
          <button id="addRoi" class="btn small">‚ûï Nueva √°rea</button>
          <button id="clearRois" class="btn small danger">üóëÔ∏è Limpiar √°reas</button>
          <button id="resetView" class="btn small alt">‚ü≥ Reset vista</button>
        </div>
        <canvas id="grindCanvas"></canvas>
      </div>
      <div class="panel">
        <div class="kv"><div>D10 (Œºm)</div><div id="d10">‚Äî</div></div>
        <div class="kv"><div>D50 (Œºm)</div><div id="d50">‚Äî</div></div>
        <div class="kv"><div>D90 (Œºm)</div><div id="d90">‚Äî</div></div>
        <div class="kv"><div>Media (Œºm)</div><div id="mean">‚Äî</div></div>
        <div class="kv"><div>Conteo</div><div id="count">‚Äî</div></div>
        <div class="kv"><div>√Åreas (ROI)</div><div id="roiInfo">‚Äî</div></div>
        <div class="histWrap">
          <canvas id="histCanvas" width="360" height="160"></canvas>
        </div>
        <p class="hint">Dibuja uno o varios ROIs. Usa rueda para zoom y arrastra para pan (modo Zoom/Pan activado).</p>
      </div>
    </div>
  </section>
</main>

<footer>
  <small>Hecho con ‚ù§Ô∏è para Escuela de Caf√© ‚Äî v2.1.1</small>
</footer>

<script></script>
</body>
</html>
